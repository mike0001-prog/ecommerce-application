{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="{% static 'css\bootstrap.css' %}"> -->
    <link rel="stylesheet" href="{% static 'storefront\style2.css' %}">
    <!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap JS (includes Collapse plugin) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <link rel="font" href="{% static 'storefront\Orbitron\static\Orbitron-Regular.ttf' %}">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;500&display=swap" rel="stylesheet">
    <title>TechNova | {{ title }}</title>
</head>
<body>
       
  <div class="message d-flex justify-content-center align-items-center d-none" style="
    position: fixed; 
    background: var(--cs-gray);
    top: 3%;
    left: 50%;
    z-index: 10000;
    transform: translate(-50%, -50%);
    width: 90%;
    flex-direction: column;
    box-shadow: 0px 0px  5px currentColor;
    
    "> 
             <svg width="30px" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z" />
</svg>
    <div class="text-align-center text-capitalize" >
 
      </div>
  </div>
  	

    <nav class="custom-navbar">
  
   
    <div class="sub-nav1">
        <div class="logo">TECHNOVA</div>

        </div>


    </div>
        <div class="row align-items-center px-4 ">
        <div class="col-lg-9 col-md-12 p-1">
<div class="search w-100">
              <form id="search_form" action="{% url 'search_product' %}" method="post">
                {% csrf_token %}
                <input id="action" type="hidden" name="action" value="submit">
                <input name="search" type="search" placeholder="search a product" >
                 <button>
                    <img  src="{% static 'storefront\search.svg' %}" alt="search">
                 </button>       
            </form>
      <div class="search-result">

      </div>
</div>

        </div>


       
        <div class="col-lg-3 col-md-12 p-1">
  
          <div class="row user_cart">
                              
          <div class="user col-6">
              <button class="w-sm-100">
          <svg width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
  <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd" />
</svg>

            {% if request.user.is_authenticated %}
             
                {{ request.user.username}}
            {% else %}
            account
            {% endif %}
             </button>
             <ul class="menu">
                {% if request.user.is_authenticated %}
             <a href="{% url 'user_profile' %}"><li class="menu-item">My Account</li></a> 

            <!-- <a href="{% url 'user_profile' %}"><li class="menu-item">  Billing Information</li></a> 
           <a href="{% url 'user_shipping' %}"><li class="menu-item">Shipping Information</li></a>  -->
           <a href="{% url 'storefront_orders' %}"><li class="menu-item">Orders</li></a> 
           <a href="{% url 'storefront_wishlist'%}"><li class="menu-item">Nova List</li></a> 
           <a href="{% url 'account_logout' %}"><li class="menu-item">Logout</li></a> 
            {% else %}
            <a href="{% url 'account_login' %}"><li class="menu-item">Login</li></a>
            {% endif %}
         </ul>
        
        </div>

      





          <!-- {% if user.is_authenticated %}
          <a href="{% url 'account_logout' %}">
            <button class="btn-neon">
            Logout
         </button>
            </a>
          {% endif %}
          {% if not user.is_authenticated %}
          <a href="{% url 'account_login' %}">
            <button class="btn-neon">
            Login
        </button>
            </a> -->

          <!-- {% endif %} -->
        
            <div class="col-6">
          <a class="d-inline-block" href="{% url 'cart_summary' %}" style="text-decoration: none;">
        <div class="btn-neonC">
            <button>
                <!-- <img style="width: 30px; display: block;" src="{% static 'storefront\cart-shopping.svg' %}" alt=""> -->
                <svg width="30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6">
  <path d="M2.25 2.25a.75.75 0 0 0 0 1.5h1.386c.17 0 .318.114.362.278l2.558 9.592a3.752 3.752 0 0 0-2.806 3.63c0 .414.336.75.75.75h15.75a.75.75 0 0 0 0-1.5H5.378A2.25 2.25 0 0 1 7.5 15h11.218a.75.75 0 0 0 .674-.421 60.358 60.358 0 0 0 2.96-7.228.75.75 0 0 0-.525-.965A60.864 60.864 0 0 0 5.68 4.509l-.232-.867A1.875 1.875 0 0 0 3.636 2.25H2.25ZM3.75 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0ZM16.5 20.25a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z" />
</svg>
 
 
            </button>
            Cart<span id="cart_quantity"> {{ cart|length }}</span>
        </div>
    </a>
    </div>
          </div>
    
        </div>
    </div>
        

    </nav>


    <div class="custom-breadcrumbs">
    <div style=" width: 100%;">
        {% block breadcrumbs %}
        {% endblock breadcrumbs %}
    </div>
     <!-- <div class="left">
      {% if user.is_authenticated %}
        <button class="Profile" >
         Profile
         <ul class="menu">
           <a href="{% url 'user_profile' %}"><li class="menu-item">  Billing Information</li></a> 
           <a href="{% url 'user_shipping' %}"><li class="menu-item">Shipping Information</li></a> 
         </ul>
        </button>
    
    
      {% endif %} 
    <a href="{% url 'cart_summary' %}" style="text-decoration: none;">
        <div class="btn-neonC">
            <button>
                <img style="width: 20px; display: block;" src="{% static 'storefront\cart-shopping.svg' %}" alt="">
                 Cart
            </button>
            <span id="cart_quantity">{{ cart|length }}</span>
        </div>
    </a> 
     </div> -->
    </div>
    
        {% block body %}

        {% endblock body %}
    
    <footer class="footer">
    <p>Â© 2023 TECHNOVA | <span class="neon-pink">Powered by Innovation</span>
    <div class="text-capitalize">built by oyeniyi kehinde michael</div>
    </p>
  </footer>

    <script src="{% static 'storefront\jquery-3.7.1.min.js' %}"></script>
    <!-- <script src="https://js.paystack.co/v2/inline.js"></script> -->
    <script>
       $(function(){

          console.log($("form"))
    $(".form-remove").on("submit",function (e) {
        e.preventDefault()
        console.log($(this).attr("method"))
        let qty_holder = $("#cart_quantity")
        let parent = $(this).parent().parent()//select container for cart item info
        console.log(parent)
        $.ajax({data:$(this).serialize(),
                type:$(this).attr("method"),
                url:$(this).attr("action") ,
                success:function(response){
                if(response){
                  parent.remove()//remove the container of the product removed
                    // console.log(response.msg)
                    qty_holder.html(response.qty)
                    let body = $(".message")
                    let content = $(".message div").text(response.msg)
                    body.fadeIn()
                    body.removeClass("d-none")
                    //$(".custom-breadcrumbs").css({paddingTop:"200px"})
                   // body.css({position:"absolute",left:`${50}%`,top:`${50}%`,transform:`translate(${-50}% ,${-50}%)`})
                    setTimeout(()=>{
                      body.fadeOut()
                    // $(".custom-breadcrumbs").css({paddingTop:"140px"}) 
                    body.addClass("d-none")
                    },2000)
                    let cartitems =[...$(".cart-item")]
                    console.log(cartitems.length)
                    let cart_msg = $("#cart_msg")
                    let el = $(".cart-summary")
                    $("#total span").eq(1).text(response.total)
                    console.log(el)
                    console.log(response.total)
                    let cart_body = $(".cart-container")
                    let cart_items = $(".cart-items")
                    if(cartitems.length == 0){
                      console.log("empty")
                      el.remove()
                      cart_items.remove()
                      cart_body.append(`<div id="cart_msg" style="text-transform: capitalize; text-align: center; padding: 10px;">
                         your cart is empty </div>`)
                    }
                    
                }
            }
        })
    })


        // listen for submit event on any form with class form_add
    $(".form_add").on("submit",function (e) {
        e.preventDefault()
        let cart_add = $("#form_add button")
        let qty_holder = $("#cart_quantity")
        let cart_quantity_update = $(".qty")
        let body = $(".message")
	
        console.log(qty_holder)
        console.log($(this).attr("method"))
        
        $.ajax({data:$(this).serialize(),
                type:$(this).attr("method"),
                url:$(this).attr("action") ,
                success:function(response){
                if(response){
                    // console.log(response.qty)
                    qty_holder.html(response.qty)
                    let total = $(".total span").eq(1)
                    let content = $(".message div").text(response.msg)
                    body.fadeIn()
                    body.removeClass("d-none")
                    //$(".custom-breadcrumbs").css({paddingTop:"200px"})
                   // body.css({position:"absolute",left:`${50}%`,top:`${50}%`,transform:`translate(${-50}% ,${-50}%)`})
                    setTimeout(()=>{
                      body.fadeOut()

                    // $(".custom-breadcrumbs").css({paddingTop:"140px"}) 
                    body.addClass("d-none")
                    },2000)
                    if(total){
                      console.log(total)
                      total.text(`$ ${response.total}`)
                    }
                    
                }
            }
        })
    })
   

console.log("hello world")
  // Category dropdown functionality
  const UserMenu = document.querySelector('.user');
  const UsercategoryBtn = document.querySelector('.user button');
  const UserDropdown = document.querySelector('.menu');

  
const SearchResult = document.querySelector(".search-result")
  // Toggle dropdown when clicking the button
  UsercategoryBtn.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent this click from triggering the document click handler
    const isVisible = UserDropdown.style.display === 'block';
    UserDropdown.style.display = isVisible ? 'none' : 'block';
  });

  // Close dropdown when clicking anywhere else on the page
  document.addEventListener('click', (e) => {
    // Check if the click is outside the dropdown menu
    if (!UserMenu.contains(e.target) || !SearchResult.contains(e.target)) {
      UserDropdown.style.display = 'none';
      SearchResult.style.display = 'none';
    }
  });

  // Keep dropdown open when clicking inside it
  UserDropdown.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent event from bubbling up to document
  }); 

  

const ProductContainer = $(".product-grid")
console.log(ProductContainer)
// like logic for store landing page
ProductContainer.on("submit","form",function (e) {
     e.preventDefault()
     console.log($(this).serialize())
     console.log($(this))
    LikeProduct($(this))
})
const LikeForm = $("#like")

ProductContainer.on("click",".increment",function(){
  // let input = document.querySelector(".quantity-input")
  // let value = parseInt(input.value)
  // input.value = value + 1
  console.log("test123")
 let input = $(this).siblings(".quantity-input")
 console.log(input)
 let value = parseInt(input.val()) + 1
 input.val(value)
//  console.log(value)
//  String(value)
// input.val("hello " )
})

ProductContainer.on("click",".decrement",function(){
  // let input = document.querySelector(".quantity-input")
  // let value = parseInt(input.value)
  // input.value = value + 1
  console.log("test123")
 let input = $(this).siblings(".quantity-input")
 console.log(input)
 let value = parseInt(input.val()) - 1
 input.val(value)
//  console.log(value)
//  String(value)
// input.val("hello " )
})

// like logic for product detail page 
LikeForm.on("submit",function(e){
    e.preventDefault()
    LikeProduct($(this))
    // submitBtn = $(this).children(".btn-like")

})
function LikeProduct(element) {
       $.ajax({url:element.attr("action"),
      
          type:element.attr("method"),
          data: element.serialize(),
          success: function (response) {
               console.log(response)
              const submitBtn = element.children(".btn-like")
              const input = element.children(".action")
              console.log(input)
               console.log(submitBtn)
               if(response.action === "like" ){
                  submitBtn.html(CreateButtons("unlike"))
                  input.attr("value","unlike") 
               }else if (response.action === "unlike") {
                  submitBtn.html(CreateButtons("like"))
                  input.attr("value","like")
               }
          },
          error:function(error){
          console.log(error)
          }
     })
}
function CreateButtons(action) {
      if (action === "like") {
        return ( `<svg  xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" width="30px" stroke="currentColor" class="size-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z" />
      </svg>` )
      }else if(action === "unlike"){
        return (  `<svg xmlns="http://www.w3.org/2000/svg" width="30px" viewBox="0 0 24 24" fill="currentColor" class="size-6">
  <path d="M7.493 18.5c-.425 0-.82-.236-.975-.632A7.48 7.48 0 0 1 6 15.125c0-1.75.599-3.358 1.602-4.634.151-.192.373-.309.6-.397.473-.183.89-.514 1.212-.924a9.042 9.042 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75A.75.75 0 0 1 15 2a2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H14.23c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23h-.777ZM2.331 10.727a11.969 11.969 0 0 0-.831 4.398 12 12 0 0 0 .52 3.507C2.28 19.482 3.105 20 3.994 20H4.9c.445 0 .72-.498.523-.898a8.963 8.963 0 0 1-.924-3.977c0-1.708.476-3.305 1.302-4.666.245-.403-.028-.959-.5-.959H4.25c-.832 0-1.612.453-1.918 1.227Z" />
</svg>`)
      }
}
const searchForm = $("#search_form")
const inputBox = searchForm.children("input").eq(2)


let timeoutid;
searchForm.on("input",function(e){
    e.preventDefault()
    console.log(inputBox.val().length)
    if(inputBox.val().length >= 3){
    const timeout = 500
     $(this).children("#action").attr("value","oninput")
    clearTimeout(timeoutid)
    timeoutid = setTimeout(()=>{
      console.log("timing")
   
    const form_data = $(this).serialize()
    console.log(form_data)
    $.ajax({
      url:$(this).attr("action"),
    type:$(this).attr("method"),
    data:$(this).serialize(),
    success: function (response) {
      if(response){
        
      const Response = [response.product]
      const SResult = $(".search-result")
      if(SResult){
         SResult.html("")
      Response.forEach((result)=>{
        console.log(result)
        SResult.html(UpdateSearchUi(result))
      })
      SResult.css({display:"block"})
      }
      // $(this).children("#action").attr("value","submit")
      }
      
    },
    error:function(error){
      console.log(error)
    }
    
  })
      //  $(this).children("#action").attr("value","submit")
},timeout)
  
    }


})

searchForm.on("submit",function (e) {
  e.preventDefault()
   $(this).children("#action").attr("value","submit")
  //  window.location.href = "{% url 'search_product' %}" 
  $(this).unbind("submit").submit()
})
function UpdateSearchUi(data) {
  return (`
  <a style="text-decoration:none; text-transform:capitalize; color:var(--cs-cyan)"  href="http://127.0.0.1:8000/store/product_info/${data.name}">
  <div class="p-4" style="background-color:#232020; border-radius:10px">
    ${data.name}
    </div>
    </a>`
  )
}


})

// update quantity 
// console.log(document.querySelector(".increment"))
// document.querySelector(".increment").addEventListener("click",function () {
//   let input = document.querySelector(".quantity-input")
//   let value = parseInt(input.value)
//   input.value = value + 1
// })
    </script>
</body>
</html>